
import com.android.identity.internal.Util
import com.android.identity.mdoc.sessionencryption.SessionEncryption
import com.android.identity.securearea.SecureArea
import id.walt.mdoc.dataelement.ByteStringElement
import id.walt.mdoc.dataelement.EncodedCBORElement
import id.walt.mdoc.dataelement.ListElement
import id.walt.mdoc.dataelement.StringElement
import java.util.*

class SessionTesting {
}


suspend fun main(){

    val eDeviceKeyCurve = SecureArea.EC_CURVE_P256
    val eDeviceKeyPair = Util.createEphemeralKeyPair(eDeviceKeyCurve)

    val eReaderKeyPair = Util.createEphemeralKeyPair(eDeviceKeyCurve)

    val stringeleme = ByteStringElement("device_engagement".toByteArray())
    val ereaderbytes = ByteStringElement(eReaderKeyPair.public.encoded)

    val listelem = listOf(stringeleme, ereaderbytes)

    val list = ListElement(listelem)

    val sessionTranscript = list.toCBOR()


    val test: SessionEncryption = SessionEncryption(
        0,
        eDeviceKeyPair,
        eReaderKeyPair.public,
        sessionTranscript
    )

    println(test)


    println(test.encryptMessage("ovo je plaintext".toByteArray(), OptionalLong.empty()).joinToString(""){ String.format("%02X", it) })


    val messagebtyearay = byteArrayOf(
        -94, 106, 101, 82, 101, 97, 100, 101, 114, 75, 101, 121, -40, 24, 88, 75, -92, 1, 2, 32, 1, 33, 88, 32, 79, -63, 67, 8, 56, -71, 51, 98, -12, 74, -127, 28, -33, -65, -128, 18, 117, -51, -67, -6, 36, 68, 121, 103, -89, 64, -115, 62, -30, 47, 72, -30, 34, 88, 32, -99, -21, 104, -26, -18, 77, -57, 78, 10, 67, 125, -76, -115, 58, 13, -110, 108, -105, -13, -51, 15, -52, -96, -50, 2, -14, -73, -14, 50, -13, -86, -73, 100, 100, 97, 116, 97, 89, 5, 1, 33, 47, 49, -38, 9, -38, 93, 118, -90, 13, 127, 114, -35, 80, -6, -89, 18, 10, -85, 126, -34, 103, 46, -16, -22, 85, 101, -4, 37, -115, 25, -83, -118, -10, 109, -82, -38, 88, 88, 24, -33, 102, 92, -100, 67, -55, 43, -9, 7, 10, 8, 13, -68, -12, 6, -85, -81, 37, -120, 55, -118, 101, -119, 7, 52, -85, 75, 111, 49, 67, 77, 71, -31, -124, -88, -42, 60, -52, 7, -78, 102, 51, 79, 22, 82, -32, 83, 3, -93, 69, 67, -19, 125, 27, -106, 8, 94, -7, -16, 13, 90, -83, -79, 3, 20, -114, 39, -95, -44, -93, 10, -84, 93, 66, -111, -31, 90, -71, 2, 117, -23, -67, 117, 57, -126, 52, -128, -7, -31, -36, 125, 30, 2, -86, 125, 6, 114, -76, -7, 113, -83, 100, -86, -49, 53, -45, 53, 85, 20, -70, 26, -31, 106, -87, 122, 26, 107, -6, -32, -28, 96, -12, -68, 119, -126, -4, 14, -38, 41, 60, 110, 25, 25, -67, 34, -6, -64, 114, -122, 90, 105, -68, 89, -93, 2, 61, -20, 4, -20, -62, -116, 13, -81, 58, 24, 89, 118, 0, -42, 99, 70, 108, 102, 64, -116, 42, -88, 84, 91, 34, 79, -77, -36, -102, -16, -12, 56, -72, -83, 3, 121, -112, 78, -41, -49, -121, 118, -69, -35, 51, 86, -68, 117, 81, 11, -96, 61, -8, 110, 19, -1, 86, -65, 37, 43, -99, 123, -58, 57, 96, -31, 64, 105, -34, -79, -73, -87, -7, 45, 40, -123, 83, -57, -46, 33, 74, 44, 53, -34, -109, -40, -59, 7, 55, -74, 127, 60, -66, -105, -52, -115, 8, -126, 33, -45, 14, 102, 13, -85, -74, -72, 33, -120, -25, 8, 13, 95, -90, -108, -56, -109, -37, 26, 6, -127, -8, 60, 70, 32, 50, -20, 114, 15, 11, -7, 127, -37, 42, -115, -120, -65, -41, -12, 46, -10, -104, 76, -128, 96, -110, -112, 75, 16, -78, -33, -20, -107, 64, 40, 15, -52, 0, -56, 58, 8, -24, 99, -126, -69, 98, -91, -54, 126, -26, -96, -10, -70, -75, -7, -85, 98, -73, 20, -70, -68, 109, -80, -125, 120, 58, -43, 28, 39, -38, -85, -16, 7, -19, -87, -120, -43, 104, 120, -82, -65, 111, 42, 100, -100, 63, -52, -72, -8, 81, 8, -10, -103, -52, 127, -113, 83, 48, -91, 50, -30, -13, -46, -22, 102, -122, 66, -119, -18, -87, -33, -67, -50, 84, 29, 38, -4, -79, 4, 115, -40, 62, 92, 94, -16, 3, -125, 44, -55, 57, 17, -30, 4, 15, -102, 68, 36, 22, 107, -87, 72, -1, -106, -67, -73, 94, -31, -74, -85, 87, -87, 113, 85, -57, -120, -23, 31, 96, 100, -8, 65, -36, -103, 57, -104, 108, 62, -70, -53, 72, 32, -17, 81, -40, 43, 103, -12, -58, -98, -67, -75, 92, -123, 63, 36, -74, -80, 55, 98, 52, -68, 119, -84, -85, -41, 81, -29, -21, -43, 3, 35, -10, -108, -5, 57, 7, 32, -89, -11, 20, -64, 73, 121, 112, 126, 18, 18, 66, -79, -35, -111, -40, -33, 83, 89, -11, 117, -50, -34, -29, 44, 23, 102, 47, 82, 28, 43, -64, 112, -8, 58, 85, -113, -128, -51, 15, -70, -21, 52, -105, -49, 125, -23, 43, 6, 68, -126, 30, -25, -78, 56, 107, -105, -115, -48, -36, 96, -90, -93, -22, 69, 48, -71, -95, -102, 91, -69, -116, -118, 81, 124, -64, 62, -73, 103, 31, -57, -94, 98, 95, 2, -73, -54, 18, -92, -105, -43, -108, 41, -51, -108, -99, 52, 109, 96, -13, -8, -88, -84, -88, 87, -96, 96, 43, 51, 124, 33, -9, 8, -60, -69, 115, -17, -52, 45, 73, 104, -70, -116, -40, -53, 102, 81, 118, 18, 119, -47, -116, -19, 18, 92, -15, 21, -105, 6, -39, -12, -70, 122, -99, -24, -112, 50, 124, -14, -13, 13, 100, 80, -82, 85, -83, 109, -69, 11, 31, -98, 13, -12, 51, -94, -84, 23, 87, -99, -21, 19, 34, -110, 14, -60, -62, -93, 39, -38, 30, -43, -4, -80, -25, -40, -53, -126, 55, -76, 15, -60, 45, 121, 2, 106, -16, 15, -101, -30, 125, 35, 84, 43, -84, -74, 119, 86, -43, 114, 0, 102, -128, 72, 16, -72, 77, -96, -80, 45, 1, 101, 75, -58, 32, -18, 123, 8, 108, -72, -6, -82, 81, 33, -56, -95, -71, -42, 46, 1, -2, 7, 32, 22, 7, 46, 75, 63, 64, 106, -109, 41, -19, -73, -114, -92, 65, 49, -1, 118, -46, 106, -43, 103, 126, 82, 98, 61, -12, -7, -30, 89, 96, -128, -6, -46, 114, 59, 31, 2, 29, -75, -38, 51, 57, 73, -65, -19, 98, -79, 4, -107, -2, -6, -21, 50, 65, 6, 83, 97, -107, -67, 69, 100, 81, -91, -53, -103, 57, 30, 27, 127, 78, 21, -73, 11, 119, 14, 120, 71, 5, 42, -54, -128, 33, -20, 114, -85, -46, 49, 31, 90, -110, 85, -77, -51, -53, -3, -117, 21, 125, 122, 9, -60, -72, -92, -58, -123, -72, 39, -21, 89, -82, -94, 38, 18, -39, -60, -71, 13, -87, 58, -110, 123, 77, 32, 98, -87, 105, 80, -59, 45, -76, 80, -121, 97, 126, 95, -80, 74, 9, -57, -117, -35, -66, 59, 80, -11, -8, 32, -59, -91, -59, 89, -61, -126, 25, -64, -55, -31, -57, -70, -94, 104, 14, -80, -86, -66, 48, 122, -5, 19, 46, -69, 63, -13, -120, -83, -38, -19, -122, 49, 56, 100, 105, -114, -107, -108, 66, -127, -91, -92, 90, -111, 67, -96, -121, -77, -114, 1, -25, 2, 36, -48, -59, -98, -45, -120, -123, 101, 18, -63, 30, 118, -109, -103, 108, -57, 98, -16, 26, -86, -92, -105, 34, 49, 6, -18, -73, 102, 74, -107, 100, -105, 68, 16, 78, 106, -1, 119, -8, 111, -63, 52, -17, -48, 107, 27, -106, -38, 50, -90, -57, 55, 31, 120, 55, 43, 60, 87, 1, -24, -25, -114, -6, -29, -64, -72, -86, -121, -49, -19, 33, 113, -25, 76, -70, -4, 100, -6, -83, -15, -103, -115, 87, -42, 25, 50, -80, 87, 113, -112, -24, 101, -14, -102, -106, 31, -105, 22, 99, 51, 92, -71, 118, -30, 28, -92, 3, 1, 67, 92, 117, 96, 79, -94, 32, -49, -32, -46, -15, 87, -73, 103, -75, 18, 3, -112, -39, 108, -56, 100, 19, 52, -70, 76, -124, 110, 110, -110, 45, 119, 92, 48, 51, -122, -14, -111, -26, -24, 95, 10, 82, -21, -100, 86, -72, 104, 101, 73, -51, -91, 116, 116, 110, 22, -38, -112, 66, -84, 47, 33, -101, 38, -26, 64, 15, -39, 27, 92, -90, -7, -67, 90, 109, 121, -29, 10, 53, -20, -98, 0, 35, -10, 109, 12, 43, 116, 33, -30, -51, 15, -79, 108, -107, 77, 51, 95, -95, 70, -60, -101, 5, -97, -111, -15, 67, 53, 124, 80, 43, 47, 105, -109, -121, -89, -16, -116, -36, -10, -23, 40, 59, -39, 55, 54, -107, -83, 89, -121, 29, -32, 71, -45, 15, -77, -86, 72, -8, 33, -120, 108, -77, 14, -84, 100, -103, -46, -112, 105, -93, -17, -3, 104, 30, 30, -92, -48, -1, -30, 102, 62, -26, 75, 17, 63, -55, -27, -52, -41, 39, -109, 48, 50, -124, -21, -11, 47, -86, -93, -11, -71, -52, -22, -22, -63, -125, 17, -87, -69, -66, -43, 4, -104, -111, 95, 50, 71, -102, -69, 69, 8, -114, 21, 87, -74, 5, 94, -1, 116, -22, -91, 112, -97, 107, 2, 120, 111, 34, -15, -45, 54
    )

    println(messagebtyearay.joinToString(""){ String.format("%02X", it) })

    println("android")


}